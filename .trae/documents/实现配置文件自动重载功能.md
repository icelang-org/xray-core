# 实现配置文件自动重载功能

## 方案概述

在Xray-core中实现配置文件自动重载功能，当config.json文件发生变化时，自动重新加载配置并重启服务。

## 实现步骤

1. **添加文件监控依赖**
   - 在go.mod中添加fsnotify库依赖，用于监控文件变化

2. **修改main/run.go文件**
   - 在executeRun函数中添加文件监控逻辑
   - 创建一个goroutine监控配置文件变化
   - 当配置文件变化时，重启服务器

3. **实现服务器重启逻辑**
   - 当检测到配置文件变化时，关闭当前服务器实例
   - 重新加载配置文件
   - 创建新的服务器实例并启动

4. **优化错误处理**
   - 处理配置文件解析错误
   - 确保服务器重启过程中的稳定性

## 具体修改点

1. **main/run.go**
   - 添加fsnotify库导入
   - 在executeRun函数中添加文件监控代码
   - 实现配置文件变化时的重启逻辑

2. **核心逻辑**
   - 使用fsnotify监控配置文件
   - 当文件变化时，触发服务器重启
   - 确保重启过程中服务的连续性

## 技术要点

- 使用fsnotify库实现高效的文件监控
- 采用优雅关闭机制确保服务稳定性
- 实现配置文件变化的实时检测
- 保持代码的简洁性和可维护性